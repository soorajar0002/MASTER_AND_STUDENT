{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/HP/OneDrive/Desktop/MASTER AND STUDENT/master_and_student/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/HP/OneDrive/Desktop/MASTER AND STUDENT/master_and_student/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';// eslint-disable-next-line camelcase\nimport jwt_decode from'jwt-decode';import dayjs from'dayjs';import{useSelector,useDispatch}from'react-redux';import{setToken}from'../redux/reducers/AuthSlice';var baseURL='http://127.0.0.1:8000/api/';var useAxios=function useAxios(){var authTokens=useSelector(function(state){return state.token.token.access_token;});var authRefresh=useSelector(function(state){return state.token.token.refresh_token;});console.log('access token',authTokens);console.log('refresh token',authRefresh);var dispatch=useDispatch();var axiosInstance=axios.create({baseURL:baseURL,headers:{Authorization:\"Bearer \".concat(authTokens)}});axiosInstance.interceptors.request.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(req){var user,isExpired,response,token;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:user=jwt_decode(authTokens);isExpired=dayjs.unix(user.exp).diff(dayjs())<1;console.log(isExpired);if(isExpired){_context.next=5;break;}return _context.abrupt(\"return\",req);case 5:_context.next=7;return axios.post(\"\".concat(baseURL,\"token/refresh/\"),{refresh:authRefresh});case 7:response=_context.sent;console.log('access and refresh token in axios',response.data);token={token:response.data};dispatch(setToken(token));console.log(req.headers);console.log(response.data,'hai');req.headers.Authorization=\"Bearer \".concat(response.data.access);return _context.abrupt(\"return\",req);case 15:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());return axiosInstance;};export default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useSelector","useDispatch","setToken","baseURL","useAxios","authTokens","state","token","access_token","authRefresh","refresh_token","console","log","dispatch","axiosInstance","create","headers","Authorization","interceptors","request","use","req","user","isExpired","unix","exp","diff","post","refresh","response","data","access"],"sources":["C:/Users/HP/OneDrive/Desktop/MASTER AND STUDENT/master_and_student/frontend/src/axios/useAxios.js"],"sourcesContent":["import axios from 'axios';\r\n// eslint-disable-next-line camelcase\r\nimport jwt_decode from 'jwt-decode';\r\nimport dayjs from 'dayjs';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { setToken } from '../redux/reducers/AuthSlice'\r\n\r\nconst baseURL = 'http://127.0.0.1:8000/api/';\r\n\r\nconst useAxios = () => {\r\n  const authTokens = useSelector((state) => state.token.token.access_token);\r\n  const authRefresh = useSelector((state) => state.token.token.refresh_token);\r\n  console.log('access token', authTokens);\r\n  console.log('refresh token', authRefresh);\r\n  const dispatch = useDispatch();\r\n\r\n  const axiosInstance = axios.create({\r\n    baseURL,\r\n    headers: { Authorization: `Bearer ${authTokens}` },\r\n  });\r\n\r\n  axiosInstance.interceptors.request.use(async (req) => {\r\n    const user = jwt_decode(authTokens);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n    console.log(isExpired);\r\n    if (!isExpired) return req;\r\n\r\n    const response = await axios.post(`${baseURL}token/refresh/`, {\r\n      refresh: authRefresh,\r\n    });\r\n    console.log('access and refresh token in axios', response.data);\r\n    const token = { token: response.data };\r\n    dispatch(setToken(token));\r\n    console.log(req.headers);\r\n    console.log(response.data, 'hai');\r\n    req.headers.Authorization = `Bearer ${response.data.access}`;\r\n    return req;\r\n  });\r\n\r\n  return axiosInstance;\r\n};\r\n\r\nexport default useAxios;"],"mappings":"kVAAA,MAAOA,MAAK,KAAM,OAAO,CACzB;AACA,MAAOC,WAAU,KAAM,YAAY,CACnC,MAAOC,MAAK,KAAM,OAAO,CACzB,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,QAAQ,KAAQ,6BAA6B,CAEtD,GAAMC,QAAO,CAAG,4BAA4B,CAE5C,GAAMC,SAAQ,CAAG,QAAXA,SAAQ,EAAS,CACrB,GAAMC,WAAU,CAAGL,WAAW,CAAC,SAACM,KAAK,QAAKA,MAAK,CAACC,KAAK,CAACA,KAAK,CAACC,YAAY,GAAC,CACzE,GAAMC,YAAW,CAAGT,WAAW,CAAC,SAACM,KAAK,QAAKA,MAAK,CAACC,KAAK,CAACA,KAAK,CAACG,aAAa,GAAC,CAC3EC,OAAO,CAACC,GAAG,CAAC,cAAc,CAAEP,UAAU,CAAC,CACvCM,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEH,WAAW,CAAC,CACzC,GAAMI,SAAQ,CAAGZ,WAAW,EAAE,CAE9B,GAAMa,cAAa,CAAGjB,KAAK,CAACkB,MAAM,CAAC,CACjCZ,OAAO,CAAPA,OAAO,CACPa,OAAO,CAAE,CAAEC,aAAa,kBAAYZ,UAAU,CAAG,CACnD,CAAC,CAAC,CAEFS,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,4FAAC,iBAAOC,GAAG,qJACzCC,IAAI,CAAGxB,UAAU,CAACO,UAAU,CAAC,CAC7BkB,SAAS,CAAGxB,KAAK,CAACyB,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAAC3B,KAAK,EAAE,CAAC,CAAG,CAAC,CACxDY,OAAO,CAACC,GAAG,CAACW,SAAS,CAAC,CAAC,GAClBA,SAAS,yDAASF,GAAG,+BAEHxB,MAAK,CAAC8B,IAAI,WAAIxB,OAAO,mBAAkB,CAC5DyB,OAAO,CAAEnB,WACX,CAAC,CAAC,QAFIoB,QAAQ,eAGdlB,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAEiB,QAAQ,CAACC,IAAI,CAAC,CACzDvB,KAAK,CAAG,CAAEA,KAAK,CAAEsB,QAAQ,CAACC,IAAK,CAAC,CACtCjB,QAAQ,CAACX,QAAQ,CAACK,KAAK,CAAC,CAAC,CACzBI,OAAO,CAACC,GAAG,CAACS,GAAG,CAACL,OAAO,CAAC,CACxBL,OAAO,CAACC,GAAG,CAACiB,QAAQ,CAACC,IAAI,CAAE,KAAK,CAAC,CACjCT,GAAG,CAACL,OAAO,CAACC,aAAa,kBAAaY,QAAQ,CAACC,IAAI,CAACC,MAAM,CAAE,CAAC,gCACtDV,GAAG,wDACX,+DAAC,CAEF,MAAOP,cAAa,CACtB,CAAC,CAED,cAAeV,SAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}