{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from 'axios';\n// eslint-disable-next-line camelcase\nimport jwt_decode from 'jwt-decode';\nimport dayjs from 'dayjs';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setToken } from '../redux/reducers/AuthSlice';\nconst baseURL = 'http://127.0.0.1:8000/api/';\nconst useAxios = () => {\n  _s();\n  const authTokens = useSelector(state => state.toke.token.access_token);\n  const authRefresh = useSelector(state => state.user.token.refresh_token);\n  console.log('access token', authTokens);\n  console.log('refresh token', authRefresh);\n  const dispatch = useDispatch();\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authTokens}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    console.log(isExpired);\n    if (!isExpired) return req;\n    const response = await axios.post(`${baseURL}token/refresh/`, {\n      refresh: authRefresh\n    });\n    console.log('access and refresh token in axios', response.data);\n    const token = {\n      token: response.data\n    };\n    dispatch(setToken(token));\n    console.log(req.headers);\n    console.log(response.data, 'hai');\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n  return axiosInstance;\n};\n_s(useAxios, \"4UI9MJhzlW+eo6iGlCZtTzAlVYo=\", false, function () {\n  return [useSelector, useSelector, useDispatch];\n});\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useSelector","useDispatch","setToken","baseURL","useAxios","authTokens","state","toke","token","access_token","authRefresh","user","refresh_token","console","log","dispatch","axiosInstance","create","headers","Authorization","interceptors","request","use","req","isExpired","unix","exp","diff","response","post","refresh","data","access"],"sources":["C:/Users/HP/OneDrive/Desktop/MASTER AND STUDENT/frontend/src/axios/useAxios.js"],"sourcesContent":["import axios from 'axios';\r\n// eslint-disable-next-line camelcase\r\nimport jwt_decode from 'jwt-decode';\r\nimport dayjs from 'dayjs';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { setToken } from '../redux/reducers/AuthSlice'\r\n\r\nconst baseURL = 'http://127.0.0.1:8000/api/';\r\n\r\nconst useAxios = () => {\r\n  const authTokens = useSelector((state) => state.toke.token.access_token);\r\n  const authRefresh = useSelector((state) => state.user.token.refresh_token);\r\n  console.log('access token', authTokens);\r\n  console.log('refresh token', authRefresh);\r\n  const dispatch = useDispatch();\r\n\r\n  const axiosInstance = axios.create({\r\n    baseURL,\r\n    headers: { Authorization: `Bearer ${authTokens}` },\r\n  });\r\n\r\n  axiosInstance.interceptors.request.use(async (req) => {\r\n    const user = jwt_decode(authTokens);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n    console.log(isExpired);\r\n    if (!isExpired) return req;\r\n\r\n    const response = await axios.post(`${baseURL}token/refresh/`, {\r\n      refresh: authRefresh,\r\n    });\r\n    console.log('access and refresh token in axios', response.data);\r\n    const token = { token: response.data };\r\n    dispatch(setToken(token));\r\n    console.log(req.headers);\r\n    console.log(response.data, 'hai');\r\n    req.headers.Authorization = `Bearer ${response.data.access}`;\r\n    return req;\r\n  });\r\n\r\n  return axiosInstance;\r\n};\r\n\r\nexport default useAxios;"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB;AACA,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACtD,SAASC,QAAQ,QAAQ,6BAA6B;AAEtD,MAAMC,OAAO,GAAG,4BAA4B;AAE5C,MAAMC,QAAQ,GAAG,MAAM;EAAA;EACrB,MAAMC,UAAU,GAAGL,WAAW,CAAEM,KAAK,IAAKA,KAAK,CAACC,IAAI,CAACC,KAAK,CAACC,YAAY,CAAC;EACxE,MAAMC,WAAW,GAAGV,WAAW,CAAEM,KAAK,IAAKA,KAAK,CAACK,IAAI,CAACH,KAAK,CAACI,aAAa,CAAC;EAC1EC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAET,UAAU,CAAC;EACvCQ,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEJ,WAAW,CAAC;EACzC,MAAMK,QAAQ,GAAGd,WAAW,EAAE;EAE9B,MAAMe,aAAa,GAAGnB,KAAK,CAACoB,MAAM,CAAC;IACjCd,OAAO;IACPe,OAAO,EAAE;MAAEC,aAAa,EAAG,UAASd,UAAW;IAAE;EACnD,CAAC,CAAC;EAEFW,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAOC,GAAG,IAAK;IACpD,MAAMZ,IAAI,GAAGb,UAAU,CAACO,UAAU,CAAC;IACnC,MAAMmB,SAAS,GAAGzB,KAAK,CAAC0B,IAAI,CAACd,IAAI,CAACe,GAAG,CAAC,CAACC,IAAI,CAAC5B,KAAK,EAAE,CAAC,GAAG,CAAC;IACxDc,OAAO,CAACC,GAAG,CAACU,SAAS,CAAC;IACtB,IAAI,CAACA,SAAS,EAAE,OAAOD,GAAG;IAE1B,MAAMK,QAAQ,GAAG,MAAM/B,KAAK,CAACgC,IAAI,CAAE,GAAE1B,OAAQ,gBAAe,EAAE;MAC5D2B,OAAO,EAAEpB;IACX,CAAC,CAAC;IACFG,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEc,QAAQ,CAACG,IAAI,CAAC;IAC/D,MAAMvB,KAAK,GAAG;MAAEA,KAAK,EAAEoB,QAAQ,CAACG;IAAK,CAAC;IACtChB,QAAQ,CAACb,QAAQ,CAACM,KAAK,CAAC,CAAC;IACzBK,OAAO,CAACC,GAAG,CAACS,GAAG,CAACL,OAAO,CAAC;IACxBL,OAAO,CAACC,GAAG,CAACc,QAAQ,CAACG,IAAI,EAAE,KAAK,CAAC;IACjCR,GAAG,CAACL,OAAO,CAACC,aAAa,GAAI,UAASS,QAAQ,CAACG,IAAI,CAACC,MAAO,EAAC;IAC5D,OAAOT,GAAG;EACZ,CAAC,CAAC;EAEF,OAAOP,aAAa;AACtB,CAAC;AAAC,GA/BIZ,QAAQ;EAAA,QACOJ,WAAW,EACVA,WAAW,EAGdC,WAAW;AAAA;AA4B9B,eAAeG,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}