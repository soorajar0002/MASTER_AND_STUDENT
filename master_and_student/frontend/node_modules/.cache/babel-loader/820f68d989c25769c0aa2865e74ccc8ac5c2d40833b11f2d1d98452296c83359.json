{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from 'axios';\n// eslint-disable-next-line camelcase\nimport jwt_decode from 'jwt-decode';\nimport dayjs from 'dayjs';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setToken } from '../redux/reducers/AuthSlice';\nconst baseURL = 'http://127.0.0.1:8000/api/';\nconst useAxios = () => {\n  _s();\n  const authTokens = useSelector(state => state.token.token.access_token);\n  const authRefresh = useSelector(state => state.token.token.refresh_token);\n  console.log('access token', authTokens);\n  console.log('refresh token', authRefresh);\n  const dispatch = useDispatch();\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: {\n      Authorization: `Bearer ${authTokens}`\n    }\n  });\n  axiosInstance.interceptors.request.use(async req => {\n    const user = jwt_decode(authTokens);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    console.log(isExpired);\n    if (!isExpired) return req;\n    const response = await axios.post(`${baseURL}token/refresh/`, {\n      refresh: authRefresh\n    });\n    console.log('access and refresh token in axios', response.data);\n    const token = {\n      token: response.data\n    };\n    dispatch(setToken(token));\n    console.log(req.headers);\n    console.log(response.data, 'hai');\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n  return axiosInstance;\n};\n_s(useAxios, \"4UI9MJhzlW+eo6iGlCZtTzAlVYo=\", false, function () {\n  return [useSelector, useSelector, useDispatch];\n});\nexport default useAxios;","map":{"version":3,"names":["axios","jwt_decode","dayjs","useSelector","useDispatch","setToken","baseURL","useAxios","authTokens","state","token","access_token","authRefresh","refresh_token","console","log","dispatch","axiosInstance","create","headers","Authorization","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","refresh","data","access"],"sources":["C:/Users/HP/OneDrive/Desktop/MASTER AND STUDENT/master_and_student/frontend/src/axios/useAxios.js"],"sourcesContent":["import axios from 'axios';\r\n// eslint-disable-next-line camelcase\r\nimport jwt_decode from 'jwt-decode';\r\nimport dayjs from 'dayjs';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { setToken } from '../redux/reducers/AuthSlice'\r\n\r\nconst baseURL = 'http://127.0.0.1:8000/api/';\r\n\r\nconst useAxios = () => {\r\n  const authTokens = useSelector((state) => state.token.token.access_token);\r\n  const authRefresh = useSelector((state) => state.token.token.refresh_token);\r\n  console.log('access token', authTokens);\r\n  console.log('refresh token', authRefresh);\r\n  const dispatch = useDispatch();\r\n\r\n  const axiosInstance = axios.create({\r\n    baseURL,\r\n    headers: { Authorization: `Bearer ${authTokens}` },\r\n  });\r\n\r\n  axiosInstance.interceptors.request.use(async (req) => {\r\n    const user = jwt_decode(authTokens);\r\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n    console.log(isExpired);\r\n    if (!isExpired) return req;\r\n\r\n    const response = await axios.post(`${baseURL}token/refresh/`, {\r\n      refresh: authRefresh,\r\n    });\r\n    console.log('access and refresh token in axios', response.data);\r\n    const token = { token: response.data };\r\n    dispatch(setToken(token));\r\n    console.log(req.headers);\r\n    console.log(response.data, 'hai');\r\n    req.headers.Authorization = `Bearer ${response.data.access}`;\r\n    return req;\r\n  });\r\n\r\n  return axiosInstance;\r\n};\r\n\r\nexport default useAxios;"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB;AACA,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACtD,SAASC,QAAQ,QAAQ,6BAA6B;AAEtD,MAAMC,OAAO,GAAG,4BAA4B;AAE5C,MAAMC,QAAQ,GAAG,MAAM;EAAA;EACrB,MAAMC,UAAU,GAAGL,WAAW,CAAEM,KAAK,IAAKA,KAAK,CAACC,KAAK,CAACA,KAAK,CAACC,YAAY,CAAC;EACzE,MAAMC,WAAW,GAAGT,WAAW,CAAEM,KAAK,IAAKA,KAAK,CAACC,KAAK,CAACA,KAAK,CAACG,aAAa,CAAC;EAC3EC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEP,UAAU,CAAC;EACvCM,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEH,WAAW,CAAC;EACzC,MAAMI,QAAQ,GAAGZ,WAAW,EAAE;EAE9B,MAAMa,aAAa,GAAGjB,KAAK,CAACkB,MAAM,CAAC;IACjCZ,OAAO;IACPa,OAAO,EAAE;MAAEC,aAAa,EAAG,UAASZ,UAAW;IAAE;EACnD,CAAC,CAAC;EAEFS,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAOC,GAAG,IAAK;IACpD,MAAMC,IAAI,GAAGxB,UAAU,CAACO,UAAU,CAAC;IACnC,MAAMkB,SAAS,GAAGxB,KAAK,CAACyB,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAAC3B,KAAK,EAAE,CAAC,GAAG,CAAC;IACxDY,OAAO,CAACC,GAAG,CAACW,SAAS,CAAC;IACtB,IAAI,CAACA,SAAS,EAAE,OAAOF,GAAG;IAE1B,MAAMM,QAAQ,GAAG,MAAM9B,KAAK,CAAC+B,IAAI,CAAE,GAAEzB,OAAQ,gBAAe,EAAE;MAC5D0B,OAAO,EAAEpB;IACX,CAAC,CAAC;IACFE,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEe,QAAQ,CAACG,IAAI,CAAC;IAC/D,MAAMvB,KAAK,GAAG;MAAEA,KAAK,EAAEoB,QAAQ,CAACG;IAAK,CAAC;IACtCjB,QAAQ,CAACX,QAAQ,CAACK,KAAK,CAAC,CAAC;IACzBI,OAAO,CAACC,GAAG,CAACS,GAAG,CAACL,OAAO,CAAC;IACxBL,OAAO,CAACC,GAAG,CAACe,QAAQ,CAACG,IAAI,EAAE,KAAK,CAAC;IACjCT,GAAG,CAACL,OAAO,CAACC,aAAa,GAAI,UAASU,QAAQ,CAACG,IAAI,CAACC,MAAO,EAAC;IAC5D,OAAOV,GAAG;EACZ,CAAC,CAAC;EAEF,OAAOP,aAAa;AACtB,CAAC;AAAC,GA/BIV,QAAQ;EAAA,QACOJ,WAAW,EACVA,WAAW,EAGdC,WAAW;AAAA;AA4B9B,eAAeG,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}